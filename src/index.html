<!DOCTYPE html>
<html>
<head>
    <title>Leaflet Map</title>

    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- Include Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />

    <!-- Include Leaflet JS -->
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

    <style>
        #mapid { 
            position: absolute;
            top: 0;
            bottom: 0;
            left: 0;
            right: 0;
            height: 100%;
        }
    </style>
</head>
<body>
    <div id="mapid"></div>
    <input type="range" min="0" max="1" step="0.1" value="1" id="opacity-slider" style="position: absolute; top: 10px; right: 10px; z-index: 1000;">

<script>
    // const { GLColorScale } = L.TileLayer;
    // var map = L.map('mapid').setView([51.505, -0.09], 13);
    var map = L.map('mapid');

    console.log("tileserver_prefix - {{ cog_tileserver_url_prefix }}")
    console.log("fire_event_name - {{ fire_event_name }}")
    console.log("fire metadata")
    var fireMetadata = JSON.parse({{fire_metadata_json | tojson | safe}});
    console.log(fireMetadata);

    var fire_bounds = [[fireMetadata.bounds[1], fireMetadata.bounds[0]], [fireMetadata.bounds[3], fireMetadata.bounds[2]]]
    console.log("fire bounds - ", fire_bounds)

    // Add base map
    L.tileLayer('https://{s}.tile.opentopomap.org/{z}/{x}/{y}.png', {
        attribution: 'Â© OpenStreetMap contributors'
    }).addTo(map);

    // Add COG tile layer, with opacity slider
    var cogTileLayer = L.tileLayer('{{ cog_tileserver_url_prefix | safe }}{"thresholds":{"-0.9998":0, "0.045":175,"0.222":100,"0.8":25}}', {
        maxZoom: 20,
    }).addTo(map);

    var slider = document.getElementById('opacity-slider');
    slider.addEventListener('input', function(e) {
        cogTileLayer.setOpacity(e.target.value);
    });

    // Center map on fire, based on `bounds` metadata
    map.fitBounds(fire_bounds);

</script>

</body>
</html>