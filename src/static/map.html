<!DOCTYPE html>
<html>
<head>
    <title>D3.js Map</title>
    <script src="https://d3js.org/d3.v5.min.js"></script>
    <script src="https://d3js.org/topojson.v3.min.js"></script>
    <style>
      path {
        stroke: #000;
        stroke-width: 1px;
        fill: #ddd;
      }

      .metric {
        fill: #700;
      }
    </style>
</head>
<body>
  <script>
    var burnMetric = "{{ burn_metric }}";
    var fireMetadata = JSON.parse({{fire_metadata_json | tojson | safe}});
    var fireBounds = [[fireMetadata.bounds[1], fireMetadata.bounds[0]], [fireMetadata.bounds[3], fireMetadata.bounds[2]]]

    var width = 800;
    var height = 800;

    var svg = d3.select("body")
      .append("svg")
      .attr("width", width)
      .attr("height", height);

    Promise.all([
      d3.json('{{ burn_boundary_geojson_url | safe }}'), 
      d3.json('{{ ecoclass_geojson_url | safe }}'), 
    ])
    .then(([boundaryData, ecoclassData]) => {
        console.log(boundaryData);
        console.log(ecoclassData);

        var projection = d3.geoMercator()
        .fitSize([width, height], boundaryData);

        var path = d3.geoPath().projection(projection);

        // Define the zoom behavior
        var zoom = d3.zoom()
        .scaleExtent([1, 8]) // This controls how far you can zoom in and out
        .on('zoom', function() {
            svg.attr('transform', d3.event.transform);
        });
        svg.call(zoom);
        var g = svg.append('g');


        svg.selectAll("path")
            .data(ecoclassData.features)
            .enter().append("path")
            .attr("d", path)
            .attr("class", function (d) {
            return d.properties.ecoclass ? 'metric' : null;
        });

        svg.selectAll(".boundary")
            .data(boundaryData.features)
            .enter().append("path")
            .attr("d", path)
            .attr("class", "boundary");
        });
  </script>
</body>
</html>